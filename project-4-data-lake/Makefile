PYTHON=$(shell which python)

#################################################################################
# Clean                                                                         #
#################################################################################
clean:
	rm -rf .pytest_cache
	rm -rf release

#################################################################################
# Build pex                                                                     #
#################################################################################
build: clean
	mkdir -p release
	pex . -v --disable-cache -o release/datalakeingestion.pex --python=$(PYTHON)

#################################################################################
# Run pex                                                                       #
#################################################################################
run:
	$(PYTHON) release/datalake_ingestion.pex -m datalakeingestion.main


#################################################################################
# Execute the build Docker                                                      #
#################################################################################
docker:
	rm -rf out
	docker build . --target=result --output release

#################################################################################
# Deploy to prodution		                                                    #
#################################################################################
deploy: docker
